name: Release Drafter

on:
  push:
    # branches to consider in the event; optional, defaults to all
    branches:
      - main
      - master

  # pull_request event is required only for autolabeler
  pull_request:
    # Only following types are handled by the action, but one can default to all as well
    types: [opened, reopened, synchronize, edited]

permissions: write-all

jobs:
  update_release_draft:
    name: Update Release Draft
    runs-on: ubuntu-latest
    # container: catthehacker/ubuntu:act-20.04  # Uncomment it if you use it on Gitea

    steps:
      - name: Disable SSL Verify
        run: git config --global http.sslVerify false

      # - name: Setup MTK Certification
      #   uses: https://gitea.mediatek.inc/actions/mtk-cert-action@v1.2.0

      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Generate a tag
        uses: orhun/git-cliff-action@v4
        id: git-cliff-tag
        with:
          config: ./.github/cliff.toml
          args: --bumped-version

      - name: Generate a changelog
        uses: orhun/git-cliff-action@v4
        id: git-cliff-changelog
        with:
          config: ./.github/cliff.toml
          args: --bump --unreleased

      - name: Upload Release Assets
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.git-cliff-tag.outputs.content }}
          name: ${{ steps.git-cliff-tag.outputs.content }} ðŸŒˆ
          body: ${{ steps.git-cliff-changelog.outputs.content }}
          draft: true
